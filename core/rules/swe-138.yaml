rules:
  - id: swe-138
    patterns:
      - pattern-inside: |
          contract $C {
            ...
            function $F() payable {
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) public {
              ...
              <... $ADDR.transfer($AMOUNT) ...>;
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) public {
              ...
              <... $ADDR.send($AMOUNT) ...>;
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) public {
              ...
              <... $ADDR.call{value:$AMOUNT}(...) ...>;
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) public {
              ...
              <... $ADDR.call{$VAL:$AMOUNT,$GAS:$GAS_VAL}(...) ...>;
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) external {
              ...
              <... $ADDR.transfer($AMOUNT) ...>;
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) external {
              ...
              <... $ADDR.send($AMOUNT) ...>;
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) external {
              ...
              <... $ADDR.call{value:$AMOUNT}(...) ...>;
              ...
            }
            ...
          }
      - pattern-not-inside: |
          contract $C {
            ...
            function $WITHDRAW(...) external {
              ...
              <... $ADDR.call{$VAL:$AMOUNT,$GAS:$GAS_VAL}(...) ...>;
              ...
            }
            ...
          }
      - focus-metavariable: $C
    message: The source code of `$C` has payable function(s) but no function to withdraw ETH, it will cause ETH to be locked in the smart contract.
    languages: [solidity]
    severity: MEDIUM
